---
title: "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è‹¦æ‰‹æ„è­˜ã‚’å…‹æœã™ã¹ãã€ãŠæ‰‹è»½ä»®æƒ³DOMã‚’è‡ªä½œã—ãŸ"
emoji: "ğŸ¤"
type: "tech"
topics: ["vuejs", "virtualdom", "javascript", "typescript"]
published: true
---

## ã¯ã˜ã‚ã«

ç§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰(PHP)ã¨ã‚¯ãƒ©ã‚¦ãƒ‰(AWS)ã‚’ä¸»è»¸ã«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç¨¼æ¥­ã‚’ã‚„ã£ã¦ã„ã“ã†ã¨æ€ã£ã¦ãŠã‚Šã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰[^1]ã«ã¤ã„ã¦ã¯ã‹ãªã‚Šè‹¦æ‰‹æ„è­˜ãŒã‚ã‚Šã¾ã—ãŸã€‚
ã§ãã‚Œã°ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã¯è·é›¢ã‚’ãŠã„ã¦ç”Ÿãã¦ã„ã“ã†ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€ç¾å®Ÿã¯ãã†ç”˜ãã‚ã‚Šã¾ã›ã‚“ã€‚
ä»•äº‹ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚’è¡Œã†æ©Ÿä¼šãŒå°‘ãªã‹ã‚‰ãšã‚ã‚Šã€æ¶ˆæ¥µçš„ãªæ°—æŒã¡ã§å–ã‚Šçµ„ã‚€ã‚ˆã‚Šã¯å‰å‘ãã«å–ã‚Šçµ„ã‚ã‚‹ã‚ˆã†ã«ãªã‚ŒãŸã‚‰ã„ã„ãªã‚ã¨ã„ã†ã“ã¨ã§ã€ãã‚ãã‚è…¹ã‚’æ‹¬ã£ã¦ã¡ã‚ƒã‚“ã¨å‹‰å¼·ã—ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚ã“ã®è¨˜äº‹ã¯ãã®è¨˜éŒ²ã§ã™ã€‚

æ—©é€Ÿã€ãã®ã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¸ã®è‹¦æ‰‹æ„è­˜ã€ã¨ã„ã†ã®ãŒã©ã“ã‹ã‚‰ç”±æ¥ã—ã¦ã„ã‚‹ã‹ã‚’è€ƒãˆã‚‹ã¨ã€
ã€Œè‡ªåˆ†ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã‚ã‹ã‚‰ãªã„ã®ã«ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é€šã‚Šã«è¨˜è¿°ã™ã‚‹ã¨ãªã‚“ã‹å‹•ãã€ã¨ã„ã†çŠ¶æ…‹ãŒæ°—æŒã¡æ‚ªã„ã‹ã‚‰ã ã¨æ€ã„ã¾ã—ãŸã€‚
ãã®ãŸã‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ´»ç”¨ã—ã¦ä½•ã‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã‚‹ã®ã§ã¯ãªãã€ãã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®åŸºç›¤ã¨ãªã‚‹æ¦‚å¿µã‚’å­¦ã¼ã†ã¨æ€ã„ã¾ã—ãŸã€‚

## ä½œã£ã¦ã¿ã¦ã©ã†ã ã£ãŸã‹
ã‹ãªã‚Šè‰¯ã‹ã£ãŸã§ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«å¯¾ã™ã‚‹è‹¦æ‰‹æ„è­˜ã‚‚å¤§éƒ¨åˆ†æ‰•æ‹­ã§ããŸã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«é–¢ã—ã¦ã¯ã†ã£ã™ã‚‰å«Œã„ã ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€å®Ÿã¯çŸ¥è­˜ãŒè¶³ã‚Šã¦ã„ãªã‹ã£ãŸã ã‘ã§ã‚ã£ãŸã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚
ã“ã®æ°—ä»˜ãã¯ã€ä»Šå¾Œæ–°ã—ã„æŠ€è¡“ã«è§¦ã‚Œã‚‹éš›ã«ã‚‚å¿ƒã«ç•™ã‚ã¦ãŠããŸã„ã§ã™ã€‚
@[tweet](https://twitter.com/khmoryz/status/1477195733376053250)

## ä½œã£ãŸã‚‚ã®
inputè¦ç´ ã«å…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’ã€ä»®æƒ³DOMã‚’é€šã˜ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«åŒæœŸã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã—ãŸã€‚
ã‚³ãƒ¼ãƒ‰é‡ã€æ©Ÿèƒ½ã¯æ¥µé™ã¾ã§æœ€å°é™ã¨ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã—ãŸã€‚
![inputè¦ç´ å…¥åŠ›å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«è¡¨ç¤ºã™ã‚‹GIF](/images/de4c2478046173/input-reflection.gif)

ã‚³ãƒ¼ãƒ‰è¡Œæ•°ã¯100è¡Œç¨‹åº¦ãªã®ã§ã€ãªã‹ãªã‹**ãŠæ‰‹è»½**ã«ã§ããŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

```
$ cloc . --exclude-dir=node_modules --by-file --not-match-f=^.+\.json$
       9 text files.
       9 unique files.                              
       3 files ignored.

github.com/AlDanial/cloc v 1.90  T=0.01 s (659.1 files/s, 14594.9 lines/s)
---------------------------------------------------------------------------------------
File                                     blank        comment           code
---------------------------------------------------------------------------------------
./src/index.js                               4              0             38
./src/pvdom/diff.js                          2              1             31
./src/pvdom/patch.js                         1              0             19
./src/pvdom/pvdom.js                         4              1             19
./src/pvdom/renderNode.js                    3              0             15
./README.md                                  4              0              9
./index.html                                 0              0              4
---------------------------------------------------------------------------------------
SUM:                                        18              2            135
---------------------------------------------------------------------------------------
```

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦Githubã«ã‚ã‚Šã¾ã™ã€‚

https://github.com/khmory/plain-virtual-dom

## ä»®æƒ³DOMã¨ã¯
ä»®æƒ³DOMã«ã¤ã„ã¦å­¦ã¶å‰ã«ã€DOMã¨ã¯ä½•ã‹ã‚’å­¦ã¶å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
MDNã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

> â€” ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã‚’è¡¨ã™ HTML ã®ã‚ˆã†ã« â€” æ–‡æ›¸ã®æ§‹é€ ã‚’ãƒ¡ãƒ¢ãƒªãƒ¼å†…ã«è¡¨ç¾ã™ã‚‹ã“ã¨ã§ã€ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’æ¥ç¶šã™ã‚‹ã‚‚ã®ã§ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model

ã‚‚ã†å°‘ã—å…·ä½“åŒ–ã™ã‚‹ã¨ã€HTMLæ–‡æ›¸ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ¢ãƒªä¸Šã«å±•é–‹ã—ã€æ“ä½œå¯èƒ½ã«ã—ãŸã‚‚ã®ã€ã¨ã„ã†ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

ä»®æƒ³DOMã¨ã„ã†ã®ã¯ã€ã“ã®DOMã®ä»®æƒ³çš„ãªå§¿ã‚’JavaScriptã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ä¿æ™‚ã—ã€ãã‚Œã‚’é©æ™‚DOMã«é©ç”¨ã™ã‚‹ä»•çµ„ã¿ã‚’ç¤ºã—ãŸæ¦‚å¿µã§ã™ã€‚
ã§ã¯ã€å¾“æ¥ã®JavaScripté–‹ç™ºã¨ã€ä»®æƒ³DOMã‚’ä½¿ç”¨ã—ãŸé–‹ç™ºã§ã®é•ã„ã‚’ä¸‹è¨˜ã«ç¤ºã—ã¾ã™ã€‚ 

### å¾“æ¥ã®JavaScriptå®Ÿè¡Œ

1. JavaScriptãŒAPIã‚’é€šã—ã¦ãƒªã‚¢ãƒ«DOM[^2]ã‚’ç›´æ¥æ“ä½œ
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®è¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œã‚‹

### ä»®æƒ³DOMã‚’ä½¿ç”¨ã—ãŸJavaScriptå®Ÿè¡Œ

1. ä»®æƒ³DOMã‚’å¤‰æ›´ã™ã‚‹
2. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒä»®æƒ³DOMã¨ãƒªã‚¢ãƒ«DOMã®å·®åˆ†ã‚’æ¤œçŸ¥(diff)ã—ã€å·®åˆ†ã‚’ãƒªã‚¢ãƒ«DOMã«é©ç”¨(patch)
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®è¡¨ç¤ºãŒæ›´æ–°ã•ã‚Œã‚‹

ä»®æƒ³DOMã‚’ä½¿ç”¨ã—ãŸã»ã†ãŒ1ã‚¹ãƒ†ãƒƒãƒ—ãŒå¢—ãˆã¦ã„ã¾ã™ãŒã€ã“ã‚Œã«ã¯å¤§ããªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚
ãã‚Œã¯ã€DOMã‚’å®£è¨€çš„ã«è¨˜è¿°ã§ãã‚‹(ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã»ã—ã„DOMã‚’ç¤ºã™ã¨ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºã‚’ãã‚Œã«åˆã‚ã›ã¦ãã‚Œã‚‹)ã¨ã„ã†ã“ã¨ã§ã™ã€‚

>ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Š React ã®å®£è¨€å‹ API ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚ã‚ãªãŸã¯ UI ã‚’ã©ã®ã‚ˆã†ãªçŠ¶æ…‹ã«ã—ãŸã„ã®ã‹ React ã«ä¼ãˆã€React ã¯å¿…ãš DOM ã‚’ãã®çŠ¶æ…‹ã¨ä¸€è‡´ã•ã›ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€React ãªã—ã§ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«é¿ã‘ã¦é€šã‚Œãªã„å±æ€§ã®æ“ä½œã‚„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãŠã‚ˆã³æ‰‹å‹•ã§ã® DOM æ›´æ–°ãŒæŠ½è±¡åŒ–ã•ã‚Œã¾ã™ã€‚

https://ja.reactjs.org/docs/faq-internals.html

#### å‚è€ƒ
https://qiita.com/mizchi/items/4d25bc26def1719d52e6

æ¬¡ã«ã€ä»®æƒ³DOMã®è¡¨ç¾ã«ã¤ã„ã¦ã§ã™ã€‚
HTMLã®JSONç‰ˆã¨ã„ã£ãŸã¨ã“ã‚ã§ã—ã‚‡ã†ã‹ã€‚

**ä»®æƒ³DOM**

```
{
  tagName: "div",
  attributes: { id: "div-id", content: "" },
  children: [
    {
      tagName: "h3",
      attributes: { id: "p-id", content: "" },
      children: [
        {
          tagName: "text",
          attributes: { id: "text-id", content: "å…¥åŠ›å†…å®¹: " },
        },
      ],
    },
  ],
};
```

ãã—ã¦ã€ã“ã®ä»®æƒ³DOMã«å¯¾å¿œã™ã‚‹HTMLã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

**HTML**

```
<div id="div-id" content="">
  <h3 id="p-id" content="">å…¥åŠ›å†…å®¹: </h3>
</div>
```

## å®Ÿéš›ã«ä½œã£ã¦ã„ã
ä¸‹è¨˜ã®4ã¤ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚Œã°ã€ä»®æƒ³DOMã®æœ€å°é™ã®å®Ÿè£…ã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚

- ä»®æƒ³DOMã§å®£è¨€ã—ãŸå†…å®¹ã‚’ãƒªã‚¢ãƒ«DOMã«æç”»ã™ã‚‹(render)
- ãƒªã‚¢ãƒ«DOMã¨ä»®æƒ³DOMã®å·®åˆ†ã‚’æ¤œå‡ºã™ã‚‹(diff)
- æ¤œå‡ºã—ãŸå·®åˆ†ã‚’ãƒªã‚¢ãƒ«DOMã«åæ˜ ã™ã‚‹(patch)
- é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§diff/patchã‚’ä½œå‹•ã•ã›ã‚‹

ã“ã®å†…ã€ã€Œé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§diff/patchã‚’ä½œå‹•ã•ã›ã‚‹ã€ã«ã¤ã„ã¦ã¯ã€æœ¬æ¥ã§ã‚ã‚Œã°çŠ¶æ…‹å¤‰æ›´ã‚’æ¤œçŸ¥ã™ã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã§ã™ãŒã€~~ä»Šå›ã¯ç°¡å˜ã®ãŸã‚ã€ `setInterval()` ã‚’ä½¿ç”¨ã—ã¦â—¯ãƒŸãƒªç§’ã”ã¨ã«diff/patchã‚’å‘¼ã³å‡ºã™ã“ã¨ã«ã—ã¾ã—ãŸã€‚~~
[@izumi_yoshiki](https://twitter.com/izumi_yoshiki) ã•ã‚“ã‹ã‚‰PRã‚’é ‚ãã€`requestAnimationFrame()` ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ã“ã®ã‚ã¨ã€ãã‚Œãã‚Œã®å®Ÿè£…ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

â€» å®Ÿè£…ã¯è¨˜äº‹ç”¨ã«ç°¡æ˜“åŒ–ã—ã¦ã„ã¾ã™ã€‚

### ä»®æƒ³DOMã§å®£è¨€ã—ãŸå†…å®¹ã‚’ãƒªã‚¢ãƒ«DOMã«æç”»ã™ã‚‹(render)

```
function render(vDOM) {
  const realElement = renderNode(vDOM);
  document.body.appendChild(realElement);
}

function renderNode(node) {
  const element = document.createElement(node.tagName);
  for (const key in node.attributes) {
    element.setAttribute(key, node.attributes[key]);
  }

  node.children.forEach((child) => {
    if (child.tagName == "text") {
      element.innerText = child.attributes.content;
      return;
    }
    element.appendChild(renderNode(child));
  });
  return element;
}
```

`render()` é–¢æ•°ã¯ä»®æƒ³DOMã‚ªãƒ–ã‚¸ã‚§ãƒˆã‚’å—ã‘å–ã‚Šã€ `renderNode()` é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚`renderNode()` é–¢æ•°ã¯çµ‚ç«¯ã«é”ã™ã‚‹ã¾ã§è‡ªèº«ã‚’å†å¸°çš„ã«å‘¼ã³å‡ºã—ã€Nodeã‚’è¿”å´ã—ã¾ã™ã€‚è¿”å´ã•ã‚ŒãŸNodeã‚’ `render()` é–¢æ•°ã«ã‚ˆã£ã¦ãƒªã‚¢ãƒ«DOMã®Nodeã«å¯¾ã—ã¦ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### ãƒªã‚¢ãƒ«DOMã¨ä»®æƒ³DOMã®å·®åˆ†ã‚’æ¤œå‡ºã™ã‚‹(diff)

```
function diff(oldVdom, newVdom) {
  let patchArray = [];
  diffNode(oldVdom, newVdom, patchArray);
  return patchArray;
}

function diffNode(oldNode, newNode, patchArray) {
  if (oldNode.tagName != newNode.tagName) {
    patchArray.push({
      id: oldNode.attributes.id,
      type: "tagName",
      value: newNode,
    });
  }
  if (oldNode.children && newNode.children) {
    // contentã®æ›´æ–°å¯¾è±¡ã¯è¦ªãƒãƒ¼ãƒ‰ã®idã¨ãªã‚‹ãŸã‚ã€å…ˆèª­ã¿ã™ã‚‹
    for (let i = 0; i < oldNode.children.length; i++) {
      if (
        oldNode.children[i].attributes.content !=
        newNode.children[i].attributes.content
      ) {
        patchArray.push({
          id: oldNode.attributes.id,
          type: "content",
          value: newNode.children[i].attributes.content,
        });
      }
      diffNode(oldNode.children[i], newNode.children[i], patchArray);
    }
  }
  return;
}
```

`diff()` é–¢æ•°ã¯`diffNode()`é–¢æ•°ã‚’å†å¸°çš„ã«å‘¼ã³å‡ºã—ã€ç¾åœ¨ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤ºä¸­ã®ä»®æƒ³DOMã¨ã“ã‚Œã‹ã‚‰åæ˜ ã•ã›ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ä»®æƒ³DOMã‚’å—ã‘å–ã‚Šå·®åˆ†ã‚’è¨ˆç®—ã—ã¾ã™ã€‚å·®åˆ†ã®ãƒªã‚¹ãƒˆã¯ `patchArray` ã¨ã„ã†é…åˆ—ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã®å®Ÿè£…ã¯ã‹ãªã‚Šç°¡æ˜“åŒ–ã—ã¾ã—ãŸãŒã€ä»Šå›ç›®æŒ‡ã™ã‚‚ã®ã‚’ä½œã‚‹ã«ã¯ååˆ†ã§ã™ã€‚

### æ¤œå‡ºã—ãŸå·®åˆ†ã‚’ãƒªã‚¢ãƒ«DOMã«åæ˜ ã™ã‚‹(patch)

```
function patch(patchArray) {
  let targetElement;
  let newElement;
  switch (patchArray.type) {
    case "tagName":
      targetElement = window.document.getElementById(patchArray.id);
      newElement = document.createElement(patchArray.value);
      targetElement.replaceWith(newElement);
      break;
    case "content":
      targetElement = window.document.getElementById(patchArray.id);
      targetElement.innerText = patchArray.value;
      break;
    default:
      console.error("invalid patch type");
      break;
  }
}
```

`patch()` é–¢æ•°ã¯ã€å…ˆç¨‹ `diff()` ã§ç”Ÿæˆã—ãŸ `patchArray` ã‚’ã‚‚ã¨ã«ãƒªã‚¢ãƒ«DOMã«åæ˜ ã‚’è¡Œã„ã¾ã™ã€‚ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã«ã¯idå±æ€§ã‚’ã¤ã‘ã‚‹ã‚ˆã†ã«ã—ãŸã®ã§ã€`patchArray` ã«å«ã¾ã‚Œã‚‹idã‚’ä½¿ç”¨ã—ã¦ã€DOMã‚’æ›´æ–°ã—ã¦ã„ãã¾ã™ã€‚

ã“ã“ã¾ã§ãã‚‹ã¨ã€å†’é ­ã§ç¤ºã—ãŸã‚ˆã†ãªå‡¦ç†ãŒå‹•ãã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ‰

![inputè¦ç´ å…¥åŠ›å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«è¡¨ç¤ºã™ã‚‹GIF](/images/de4c2478046173/input-reflection.gif)

## è‡ªä½œä»®æƒ³DOMã®TypeScriptåŒ–

ä¸Šè¨˜ã®å®Ÿè£…ã¯JavaScriptã§è¡Œã„ã¾ã—ãŸãŒã€ã›ã£ã‹ããªã®ã§TypeScriptåŒ–ã—ã¦ã¿ã¾ã—ãŸã€‚ä¸‹è¨˜ã®æµã‚Œã§æ®µéšçš„ã«å°å…¥ã—ã¦ã„ãã“ã¨ã§ã€ã‚µã‚¯ãƒƒã¨å‹ã‚’ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

1. `.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦ `.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›´ã—ã€`.tsconfig.json`ã‚’ä½œæˆã™ã‚‹
2. ã“ã®çŠ¶æ…‹ã§å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
3. `.tsconfig.json` ã«å°‘ã—ãšã¤è¶³ã—ã¦ã„ãã€è¡¨ç¤ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚’æ½°ã—ã¦ã„ã


æœ€çµ‚çš„ã«ã¯ [strict](https://www.typescriptlang.org/tsconfig#strict) ã‚’trueã«ã—ãŸçŠ¶æ…‹ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„ã¨ã“ã‚ã¾ã§æŒã£ã¦ã„ãã¾ã—ãŸã€‚

å®Ÿè£…ã¯ã“ã¡ã‚‰ã§ã™ã€‚
https://github.com/khmory/plain-virtual-dom-ts

## æœ¬æ ¼çš„ãªä»®æƒ³DOMå®Ÿè£…ã«ã¤ã„ã¦å­¦ã¶

ã›ã£ã‹ãä»®æƒ³DOMã«ã¤ã„ã¦å­¦ã‚“ã ã®ã§ã€æœ€å¾Œã®ãŠæ¥½ã—ã¿ã¨ã—ã¦Vue.jsã®ä»®æƒ³DOMã®å®Ÿè£…ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚
ä¸‹è¨˜ã®ãƒ–ãƒ­ã‚°ãŒã‚ã‹ã‚Šã‚„ã™ãã¾ã¨ã¾ã£ã¦ã„ã¦å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

vNodeã®æ§‹é€ ä½“ãŒã€ä»Šå›è‡ªä½œã—ãŸã‚‚ã®ã¨åŸºæœ¬çš„ãªæ§‹æˆãŒåŒã˜ãªã®ãŒæ„Ÿæ…¨æ·±ã„ã§ã™ã—ã€vNodeã®å†…éƒ¨ã«Elementã‚’ä¿æŒã—ã¦ã„ã‚‹ã®ã‚‚èˆˆå‘³æ·±ã„ã§ã™ã­ã€‚
ã¾ãŸã€diff/patchã®ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ãªã©ç§ãŒç°¡æ˜“åŒ–ã—ã¦ã—ã¾ã£ãŸéƒ¨åˆ†ãŒã—ã£ã‹ã‚Šã¨å®Ÿè£…ã•ã‚Œã¦ã„ã¦ç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚

https://blog.engineer.adways.net/entry/2018/01/19/200000

https://blog.engineer.adways.net/entry/2018/02/02/183000

https://blog.engineer.adways.net/entry/2018/02/16/190500

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è‹¦æ‰‹å…‹æœã®ãŸã‚ã€ä»®æƒ³DOMã‚’ãŠæ‰‹è»½ã«å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚
ã‚‚ã—èˆˆå‘³ãŒæ¹§ã„ãŸæ–¹ãŒã„ã‚Œã°ã€å®Ÿéš›ã«ä½œã£ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ã€‚

## å‚è€ƒ
å®Ÿè£…ã«ã‚ãŸã‚Šã€ä¸‹è¨˜ã®ãƒ–ãƒ­ã‚°ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

https://medium.com/@maheswaranapk/js-create-your-own-virtual-dom-diy-70b278999acc

https://kuroeveryday.blogspot.com/2018/11/how-to-create-virtual-dom-framework.html

https://qiita.com/umashiba/items/e2a9776e6c44a40d2d8f

## æ³¨é‡ˆ

[^1]:æœ¬è¨˜äº‹ã«ãŠã‘ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã¯ã€WEBãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€ã²ã„ã¦ã¯ Vue.jsã€Angularã€React.js ãªã©ã‚’ä½¿ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚’æŒ‡ã—ã¾ã™ã€‚ 
[^2]:ä»®æƒ³DOMã¨å¯¾æ¯”ã—ã¦ã€æœ¬æ¥ã®DOMã‚’ãƒªã‚¢ãƒ«DOMã¨å‘¼ã¶ã“ã¨ã¨ã—ã¾ã™ã€‚
