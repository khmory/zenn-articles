---
title: "フロントエンド入門としてお手軽仮想DOMを自作した"
emoji: "🐤"
type: "tech"
topics: ["vuejs", "virtualdom", "javascript", "typescript"]
published: false
---

## はじめに

私はバックエンド(PHP)とクラウド(AWS)を主軸にエンジニア稼業をやっていこうと思っており、フロントエンド[^1]についてはかなり苦手意識がありました。
できればフロントエンドとは距離をおいて生きていこうと思っていたのですが、現実はそう甘くありません。
仕事でフロントエンド開発を行う機会が少なからずあり、消極的な気持ちで取り組むよりは前向きに取り組めるようになれたらいいなあということで、そろそろ腹を括ってちゃんと勉強しようと思いました。この記事はその過程の記録です。

## なぜ仮想DOMを作ろうと思ったのか
フロントエンド開発を行うとき、**自分が何をしているのか**を知りたいからです。冒頭で述べた「フロントエンドへの苦手意識」というのがどこから由来しているかを考えると、
「自分が何をしているのかわからないのに、ドキュメントの通りに記述するとなんか動く」という状態が気持ち悪いからだと思いました。
そのため、フレームワークを活用してアプリを作ってみるのではなく、そのフレームワークの基盤となる概念を学ぼうと思いました。

## 作ってみてどうだったか
かなり良かったです。フロントエンドに対する苦手意識も大部分払拭できたような気がします。
フロントエンドに関してはうっすら嫌いだと思っていたのですが、実は知識が足りていなかっただけであったことに気づきました。
この気付きは、今後新しい技術に触れる際にも心に留めておきたいです。
@[tweet](https://twitter.com/khmoryz/status/1477195733376053250)

## 作ったもの
input要素に入力された値を、仮想DOMを通じてリアルタイムに同期する仕組みを作りました。
コード量、機能は極限まで最小限とすることを目指しました。
![input要素入力値をリアルタイムに表示するGIF](/images/de4c2478046173/input-reflection.gif)

コード行数は100行程度なので、なかなか**お手軽**にできたのではないでしょうか。

```
$ cloc . --exclude-dir=node_modules --by-file --not-match-f=^.+\.json$
       9 text files.
       9 unique files.                              
       3 files ignored.

github.com/AlDanial/cloc v 1.90  T=0.01 s (659.1 files/s, 14594.9 lines/s)
---------------------------------------------------------------------------------------
File                                     blank        comment           code
---------------------------------------------------------------------------------------
./src/index.js                               4              0             38
./src/pvdom/diff.js                          2              1             31
./src/pvdom/patch.js                         1              0             19
./src/pvdom/pvdom.js                         4              1             19
./src/pvdom/renderNode.js                    3              0             15
./README.md                                  4              0              9
./index.html                                 0              0              4
---------------------------------------------------------------------------------------
SUM:                                        18              2            135
---------------------------------------------------------------------------------------
```

ソースコードはすべてGithubにあげてあります。

https://github.com/khmory/plain-virtual-dom

## 仮想DOMとは
仮想DOMについて学ぶ前に、DOMとは何かを学ぶ必要があります。
MDNのドキュメントを参照してみましょう。

> — ウェブページを表す HTML のように — 文書の構造をメモリー内に表現することで、ウェブページとスクリプトやプログラミング言語を接続するものです。

https://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model

もう少し平易に説明すると、HTML文書をブラウザのメモリ上に展開し、操作可能にしたもの、ということができると思います。

従来のJavaScript開発と、仮想DOMを使用した開発での違いを下記に示します。 

### 従来のJavaScript

1. JavaScriptがAPIを通してリアルDOM[^2]を直接操作
2. ブラウザの表示が更新される

### 仮想DOMを使用したJavaScript

1. 仮想DOMを変更する
2. フレームワークが仮想DOMとリアルDOMの差分を検知(diff)し、差分をリアルDOMに適用(patch)
3. ブラウザの表示が更新される

仮想DOMを使用したほうがステップが多くなりますが、大きなメリットがあります。
それは、DOMを宣言的に記述できる(エンジニアが表示されてほしいDOMを示すと、フレームワークが実際のブラウザ表示をそれに合わせてくれる)ということです。

>このアプローチにより React の宣言型 API が可能になっています。あなたは UI をどのような状態にしたいのか React に伝え、React は必ず DOM をその状態と一致させます。これにより、React なしではアプリケーションを構築するために避けて通れない属性の操作やイベントハンドリング、および手動での DOM 更新が抽象化されます。

https://ja.reactjs.org/docs/faq-internals.html

#### 参考
https://qiita.com/mizchi/items/4d25bc26def1719d52e6

## 

## 注釈

[^1]:本記事におけるフロントエンドとは、WEBフロントエンド、ひいては Vue.js、Angular、React.js などを使用したフロントエンド開発を指します。 

[^2]:仮想DOMと対比して、ブラウザ上のDOMをリアルDOMと呼ぶこととします。
